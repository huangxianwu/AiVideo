2025-08-26 11:23:43,022 - __main__ - INFO - 日志文件: logs/workflow_20250826_112343.log
2025-08-26 11:23:43,022 - __main__ - INFO - === 开始执行飞书表格数据处理工作流 ===
2025-08-26 11:23:43,022 - __main__ - INFO - 🔧 步骤2: 初始化客户端连接
2025-08-26 11:23:43,022 - __main__ - INFO -    - 正在初始化飞书客户端...
2025-08-26 11:23:43,022 - __main__ - INFO -    ✅ 飞书客户端初始化完成
2025-08-26 11:23:43,022 - __main__ - INFO -    - 正在初始化ComfyUI客户端...
2025-08-26 11:23:43,022 - __main__ - INFO -    ✅ ComfyUI客户端初始化完成
2025-08-26 11:23:43,023 - __main__ - INFO -    - 正在初始化工作流处理器...
2025-08-26 11:23:43,023 - workflow_processor - INFO - 创建目录: ./temp, ./output
2025-08-26 11:23:43,023 - __main__ - INFO -    ✅ 工作流处理器初始化完成
2025-08-26 11:23:43,023 - __main__ - INFO - ✅ 所有客户端初始化完成
2025-08-26 11:23:43,023 - __main__ - INFO - 📊 步骤3: 获取飞书表格数据
2025-08-26 11:23:43,023 - __main__ - INFO -    - 正在连接飞书API...
2025-08-26 11:23:43,023 - __main__ - INFO - ▶️ 执行正常处理模式
2025-08-26 11:23:43,023 - workflow_processor - INFO - 🚀 开始工作流处理...
2025-08-26 11:23:43,023 - workflow_processor - INFO - ==================================================
2025-08-26 11:23:43,023 - workflow_processor - INFO - 📊 步骤1: 获取飞书表格数据
2025-08-26 11:23:43,023 - workflow_processor - INFO -    - 正在连接飞书API...
2025-08-26 11:23:43,023 - feishu_client - INFO -            📋 获取工作表信息...
2025-08-26 11:23:43,287 - feishu_client - INFO - Token获取成功
2025-08-26 11:23:43,719 - feishu_client - INFO - 找到目标工作表: prd_model_sheet
2025-08-26 11:23:43,720 - feishu_client - INFO -            ✅ 工作表信息获取成功: prd_model_sheet
2025-08-26 11:23:43,720 - feishu_client - INFO -            🔗 构建数据请求...
2025-08-26 11:23:43,720 - feishu_client - INFO -            - 请求范围: A2:D100
2025-08-26 11:23:43,720 - feishu_client - INFO -            🌐 发送API请求...
2025-08-26 11:23:44,284 - feishu_client - INFO -            ✅ API请求成功 (状态码: 0)
2025-08-26 11:23:44,285 - feishu_client - INFO -            📊 解析响应数据...
2025-08-26 11:23:44,285 - feishu_client - INFO -            - 原始数据行数: 99
2025-08-26 11:23:44,285 - feishu_client - INFO -            🔍 解析表格数据...
2025-08-26 11:23:44,285 - feishu_client - INFO - 使用默认列索引映射
2025-08-26 11:23:44,285 - feishu_client - INFO - 列映射: {'product_image': 0, 'model_image': 1, 'prompt': 2, 'status': 3}
2025-08-26 11:23:44,286 - feishu_client - INFO - 处理了 5 行有效数据
2025-08-26 11:23:44,286 - feishu_client - INFO -            ✅ 数据解析完成
2025-08-26 11:23:44,286 - feishu_client - INFO -            - 有效数据行数: 5
2025-08-26 11:23:44,287 - workflow_processor - INFO -    ✅ 成功获取 5 行数据
2025-08-26 11:23:44,287 - workflow_processor - INFO - 🔍 步骤2: 数据预处理和筛选
2025-08-26 11:23:44,287 - workflow_processor - INFO -    - 总行数: 5
2025-08-26 11:23:44,287 - workflow_processor - INFO -    - 需要处理: 5 行
2025-08-26 11:23:44,287 - workflow_processor - INFO -    - 跳过行数: 0 行
2025-08-26 11:23:44,288 - workflow_processor - INFO - ⚙️  步骤3: 开始逐行处理数据
2025-08-26 11:23:44,288 - workflow_processor - INFO -    🔄 队列管理已启用 - 检查间隔: 120秒
2025-08-26 11:23:44,288 - workflow_processor - INFO -    📝 处理进度: 1/5 - 行 1
2025-08-26 11:23:44,288 - workflow_processor - INFO -      🔄 开始处理第 1 行数据
2025-08-26 11:23:44,288 - workflow_processor - INFO -      🔍 子步骤1: 验证数据完整性
2025-08-26 11:23:44,288 - workflow_processor - INFO -         ✅ 数据验证通过
2025-08-26 11:23:44,288 - workflow_processor - INFO -      📥 子步骤2: 下载产品图片
2025-08-26 11:23:44,288 - workflow_processor - INFO -         - 图片信息: {'type': 'embed-image', 'fileToken': 'MMQ0b7GCvoNN5yxaAf4cyumcnen'}...
2025-08-26 11:23:44,989 - workflow_processor - INFO -         ✅ 产品图片下载完成，大小: 299292 bytes
2025-08-26 11:23:44,989 - workflow_processor - INFO -      📥 子步骤3: 下载模特图片
2025-08-26 11:23:44,990 - workflow_processor - INFO -         - 图片信息: {'type': 'embed-image', 'fileToken': 'TkQFbjmPioocwQxz2vTcLuCfnbe'}...
2025-08-26 11:23:46,182 - workflow_processor - INFO -         ✅ 模特图片下载完成，大小: 781330 bytes
2025-08-26 11:23:46,182 - workflow_processor - INFO -      🎨 子步骤4: 执行ComfyUI工作流
2025-08-26 11:23:46,182 - workflow_processor - INFO -         - 产品图片大小: 299292 bytes
2025-08-26 11:23:46,183 - workflow_processor - INFO -         - 模特图片大小: 781330 bytes
2025-08-26 11:23:46,183 - comfyui_client - INFO -         🔸 子步骤1: 上传产品图片到ComfyUI
2025-08-26 11:23:46,183 - comfyui_client - INFO -            - 图片大小: 299292 bytes
2025-08-26 11:23:47,044 - comfyui_client - INFO - 图片上传成功: api/fe06b9209ef3cc4a8b622bbcf6eec153a84da814fb25cb9f854353734799a135.png
2025-08-26 11:23:47,045 - comfyui_client - INFO -            ✅ 产品图片上传成功: api/fe06b9209ef3cc4a8b622bbcf6eec153a84da814fb25cb9f854353734799a135.png
2025-08-26 11:23:47,045 - comfyui_client - INFO -         🔸 子步骤2: 上传模特图片到ComfyUI
2025-08-26 11:23:47,045 - comfyui_client - INFO -            - 图片大小: 781330 bytes
2025-08-26 11:23:48,371 - comfyui_client - INFO - 图片上传成功: api/87cacb5a7d31a83f8e4dc1b3629d8539b17a74182e56ce85e0282c891f478836.png
2025-08-26 11:23:48,373 - comfyui_client - INFO -            ✅ 模特图片上传成功: api/87cacb5a7d31a83f8e4dc1b3629d8539b17a74182e56ce85e0282c891f478836.png
2025-08-26 11:23:48,373 - comfyui_client - INFO -         🔸 子步骤3: 创建ComfyUI工作流
2025-08-26 11:23:48,373 - comfyui_client - INFO -            - 产品图片: api/fe06b9209ef3cc4a8b622bbcf6eec153a84da814fb25cb9f854353734799a135.png
2025-08-26 11:23:48,373 - comfyui_client - INFO -            - 模特图片: api/87cacb5a7d31a83f8e4dc1b3629d8539b17a74182e56ce85e0282c891f478836.png
2025-08-26 11:23:48,607 - comfyui_client - INFO - 工作流创建成功，任务ID: 1960181357391597569
2025-08-26 11:23:48,608 - comfyui_client - INFO -            ✅ 工作流创建成功，任务ID: 1960181357391597569
2025-08-26 11:23:48,608 - comfyui_client - INFO -         🔸 子步骤4: 等待工作流执行完成
2025-08-26 11:23:48,608 - comfyui_client - INFO -            - 任务ID: 1960181357391597569
2025-08-26 11:23:48,608 - comfyui_client - INFO -            - 开始监控任务状态，最大等待时间: 300秒
2025-08-26 11:23:48,609 - comfyui_client - INFO -            - 状态检查 #1 (已等待 0.0s)
2025-08-26 11:23:48,750 - comfyui_client - INFO -            ⏳ 任务状态: RUNNING，等待 30 秒后重新检查...
2025-08-26 11:24:18,752 - comfyui_client - INFO -            - 状态检查 #2 (已等待 30.1s)
2025-08-26 11:24:18,925 - comfyui_client - INFO -            ⏳ 任务状态: RUNNING，等待 30 秒后重新检查...
2025-08-26 11:24:48,927 - comfyui_client - INFO -            - 状态检查 #3 (已等待 60.3s)
2025-08-26 11:24:49,434 - comfyui_client - INFO -            ⏳ 任务状态: RUNNING，等待 30 秒后重新检查...
2025-08-26 11:25:19,436 - comfyui_client - INFO -            - 状态检查 #4 (已等待 90.8s)
2025-08-26 11:25:24,443 - comfyui_client - ERROR - 检查任务状态时发生异常: Cannot connect to host www.runninghub.cn:443 ssl:default [Connection reset by peer]
2025-08-26 11:25:24,467 - comfyui_client - WARNING -            ⚠️ 状态检查失败 (1/3): 检查任务状态时发生异常: Cannot connect to host www.runninghub.cn:443 ssl:default [Connection reset by peer]
2025-08-26 11:25:24,468 - comfyui_client - INFO -            - 等待 10 秒后重试状态检查...
2025-08-26 11:25:34,471 - comfyui_client - INFO -            - 状态检查 #5 (已等待 105.9s)
2025-08-26 11:25:39,480 - comfyui_client - ERROR - 检查任务状态时发生异常: Cannot connect to host www.runninghub.cn:443 ssl:default [Connection reset by peer]
2025-08-26 11:25:39,480 - comfyui_client - WARNING -            ⚠️ 状态检查失败 (2/3): 检查任务状态时发生异常: Cannot connect to host www.runninghub.cn:443 ssl:default [Connection reset by peer]
2025-08-26 11:25:39,480 - comfyui_client - INFO -            - 等待 10 秒后重试状态检查...
2025-08-26 11:25:49,481 - comfyui_client - INFO -            - 状态检查 #6 (已等待 120.9s)
2025-08-26 11:25:49,825 - comfyui_client - INFO -            ✅ 任务执行成功 (总耗时 120.9s)
2025-08-26 11:25:50,219 - comfyui_client - ERROR - 获取任务输出失败: HTTP 200
2025-08-26 11:25:50,220 - comfyui_client - ERROR -            ❌ 工作流执行失败: HTTP 200
2025-08-26 11:25:50,221 - workflow_processor - ERROR -         ❌ 工作流执行失败: HTTP 200
2025-08-26 11:25:50,221 - workflow_processor - ERROR -    ❌ 行 1 处理失败: HTTP 200
2025-08-26 11:25:50,667 - feishu_client - INFO - 找到目标工作表: prd_model_sheet
2025-08-26 11:25:51,036 - feishu_client - ERROR - 更新状态时发生错误: 404, message='Attempt to decode JSON with unexpected mimetype: text/plain', url='https://open.feishu.cn/open-apis/sheets/v2/spreadsheets/Og4isDZNPhhXQcteLJRcmdMPnjc/values/35d2b7!D1'
2025-08-26 11:25:51,036 - workflow_processor - INFO -    ⏱️  等待 2 秒避免API限制...
2025-08-26 11:25:53,038 - workflow_processor - INFO -    📝 处理进度: 2/5 - 行 2
2025-08-26 11:25:53,038 - workflow_processor - INFO -      🔄 开始处理第 2 行数据
2025-08-26 11:25:53,038 - workflow_processor - INFO -      🔍 子步骤1: 验证数据完整性
2025-08-26 11:25:53,038 - workflow_processor - INFO -         ✅ 数据验证通过
2025-08-26 11:25:53,039 - workflow_processor - INFO -      📥 子步骤2: 下载产品图片
2025-08-26 11:25:53,039 - workflow_processor - INFO -         - 图片信息: {'type': 'embed-image', 'fileToken': 'VWFabZuHQo5vfWx86tlcAm1Wngb'}...
2025-08-26 11:25:56,991 - workflow_processor - INFO -         ✅ 产品图片下载完成，大小: 224833 bytes
2025-08-26 11:25:56,992 - workflow_processor - INFO -      📥 子步骤3: 下载模特图片
2025-08-26 11:25:56,992 - workflow_processor - INFO -         - 图片信息: {'type': 'embed-image', 'fileToken': 'TkQFbjmPioocwQxz2vTcLuCfnbe'}...
2025-08-26 11:26:05,595 - workflow_processor - INFO -         ✅ 模特图片下载完成，大小: 781330 bytes
2025-08-26 11:26:05,595 - workflow_processor - INFO -      🎨 子步骤4: 执行ComfyUI工作流
2025-08-26 11:26:05,595 - workflow_processor - INFO -         - 产品图片大小: 224833 bytes
2025-08-26 11:26:05,595 - workflow_processor - INFO -         - 模特图片大小: 781330 bytes
2025-08-26 11:26:05,596 - comfyui_client - INFO -         🔸 子步骤1: 上传产品图片到ComfyUI
2025-08-26 11:26:05,596 - comfyui_client - INFO -            - 图片大小: 224833 bytes
2025-08-26 11:26:13,652 - comfyui_client - INFO - 图片上传成功: api/69432e84cad586ef46f8cfa418fecd2c4f4433a80d9263c5ee55ee7161f14922.png
2025-08-26 11:26:13,653 - comfyui_client - INFO -            ✅ 产品图片上传成功: api/69432e84cad586ef46f8cfa418fecd2c4f4433a80d9263c5ee55ee7161f14922.png
2025-08-26 11:26:13,653 - comfyui_client - INFO -         🔸 子步骤2: 上传模特图片到ComfyUI
2025-08-26 11:26:13,653 - comfyui_client - INFO -            - 图片大小: 781330 bytes
2025-08-26 11:31:14,398 - comfyui_client - ERROR - 上传图片时发生异常: 
2025-08-26 11:31:14,400 - comfyui_client - ERROR -            ❌ 模特图片上传失败: 上传图片时发生异常: 
2025-08-26 11:31:14,400 - workflow_processor - ERROR -         ❌ 工作流执行失败: 模特图片上传失败: 上传图片时发生异常: 
2025-08-26 11:31:14,400 - workflow_processor - ERROR -    ❌ 行 2 处理失败: 模特图片上传失败: 上传图片时发生异常: 
2025-08-26 11:31:14,790 - feishu_client - INFO - 找到目标工作表: prd_model_sheet
2025-08-26 11:31:14,923 - feishu_client - ERROR - 更新状态时发生错误: 404, message='Attempt to decode JSON with unexpected mimetype: text/plain', url='https://open.feishu.cn/open-apis/sheets/v2/spreadsheets/Og4isDZNPhhXQcteLJRcmdMPnjc/values/35d2b7!D2'
2025-08-26 11:31:14,923 - workflow_processor - INFO -    ⏱️  等待 2 秒避免API限制...
2025-08-26 11:31:16,924 - workflow_processor - INFO -    📝 处理进度: 3/5 - 行 3
2025-08-26 11:31:16,924 - workflow_processor - INFO -      🔄 开始处理第 3 行数据
2025-08-26 11:31:16,924 - workflow_processor - INFO -      🔍 子步骤1: 验证数据完整性
2025-08-26 11:31:16,924 - workflow_processor - INFO -         ✅ 数据验证通过
2025-08-26 11:31:16,924 - workflow_processor - INFO -      📥 子步骤2: 下载产品图片
2025-08-26 11:31:16,925 - workflow_processor - INFO -         - 图片信息: {'type': 'embed-image', 'fileToken': 'KKA6bFoR7oaJPDx4xMTcJHfVnAc'}...
2025-08-26 11:31:17,902 - workflow_processor - INFO -         ✅ 产品图片下载完成，大小: 156727 bytes
2025-08-26 11:31:17,902 - workflow_processor - INFO -      📥 子步骤3: 下载模特图片
2025-08-26 11:31:17,903 - workflow_processor - INFO -         - 图片信息: {'type': 'embed-image', 'fileToken': 'TkQFbjmPioocwQxz2vTcLuCfnbe'}...
2025-08-26 11:31:19,049 - workflow_processor - INFO -         ✅ 模特图片下载完成，大小: 781330 bytes
2025-08-26 11:31:19,050 - workflow_processor - INFO -      🎨 子步骤4: 执行ComfyUI工作流
2025-08-26 11:31:19,050 - workflow_processor - INFO -         - 产品图片大小: 156727 bytes
2025-08-26 11:31:19,050 - workflow_processor - INFO -         - 模特图片大小: 781330 bytes
2025-08-26 11:31:19,050 - comfyui_client - INFO -         🔸 子步骤1: 上传产品图片到ComfyUI
2025-08-26 11:31:19,050 - comfyui_client - INFO -            - 图片大小: 156727 bytes
2025-08-26 11:31:25,608 - comfyui_client - INFO - 图片上传成功: api/e41f5a4927ddf93f0eb98d242edb794bb998d3a49a2a7114e6ca60192038672c.png
2025-08-26 11:31:25,610 - comfyui_client - INFO -            ✅ 产品图片上传成功: api/e41f5a4927ddf93f0eb98d242edb794bb998d3a49a2a7114e6ca60192038672c.png
2025-08-26 11:31:25,610 - comfyui_client - INFO -         🔸 子步骤2: 上传模特图片到ComfyUI
2025-08-26 11:31:25,610 - comfyui_client - INFO -            - 图片大小: 781330 bytes
2025-08-26 11:31:39,403 - comfyui_client - INFO - 图片上传成功: api/87cacb5a7d31a83f8e4dc1b3629d8539b17a74182e56ce85e0282c891f478836.png
2025-08-26 11:31:39,404 - comfyui_client - INFO -            ✅ 模特图片上传成功: api/87cacb5a7d31a83f8e4dc1b3629d8539b17a74182e56ce85e0282c891f478836.png
2025-08-26 11:31:39,404 - comfyui_client - INFO -         🔸 子步骤3: 创建ComfyUI工作流
2025-08-26 11:31:39,404 - comfyui_client - INFO -            - 产品图片: api/e41f5a4927ddf93f0eb98d242edb794bb998d3a49a2a7114e6ca60192038672c.png
2025-08-26 11:31:39,404 - comfyui_client - INFO -            - 模特图片: api/87cacb5a7d31a83f8e4dc1b3629d8539b17a74182e56ce85e0282c891f478836.png
2025-08-26 11:31:43,347 - comfyui_client - INFO - 工作流创建成功，任务ID: 1960183348155076609
2025-08-26 11:31:43,352 - comfyui_client - INFO -            ✅ 工作流创建成功，任务ID: 1960183348155076609
2025-08-26 11:31:43,352 - comfyui_client - INFO -         🔸 子步骤4: 等待工作流执行完成
2025-08-26 11:31:43,353 - comfyui_client - INFO -            - 任务ID: 1960183348155076609
2025-08-26 11:31:43,353 - comfyui_client - INFO -            - 开始监控任务状态，最大等待时间: 300秒
2025-08-26 11:31:43,354 - comfyui_client - INFO -            - 状态检查 #1 (已等待 0.0s)
2025-08-26 11:31:43,753 - comfyui_client - INFO -            ⏳ 任务状态: RUNNING，等待 30 秒后重新检查...
2025-08-26 11:32:13,754 - comfyui_client - INFO -            - 状态检查 #2 (已等待 30.4s)
2025-08-26 11:32:13,977 - comfyui_client - INFO -            ⏳ 任务状态: RUNNING，等待 30 秒后重新检查...
2025-08-26 11:32:43,979 - comfyui_client - INFO -            - 状态检查 #3 (已等待 60.6s)
2025-08-26 11:32:44,273 - comfyui_client - INFO -            ⏳ 任务状态: RUNNING，等待 30 秒后重新检查...
2025-08-26 11:33:14,275 - comfyui_client - INFO -            - 状态检查 #4 (已等待 90.9s)
2025-08-26 11:33:14,547 - comfyui_client - INFO -            ⏳ 任务状态: RUNNING，等待 30 秒后重新检查...
