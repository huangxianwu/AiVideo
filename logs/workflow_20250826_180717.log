2025-08-26 18:07:17,288 - __main__ - INFO - 日志文件: logs/workflow_20250826_180717.log
2025-08-26 18:07:17,288 - __main__ - INFO - === 开始执行飞书表格数据处理工作流 ===
2025-08-26 18:07:17,288 - __main__ - INFO - 🔧 步骤1: 初始化工作流管理器
2025-08-26 18:07:17,288 - __main__ - INFO -    ✅ 工作流管理器初始化完成 - 模式: 图片合成工作流
2025-08-26 18:07:17,288 - __main__ - INFO - 📊 步骤2: 获取飞书表格数据
2025-08-26 18:07:17,289 - __main__ - INFO -    - 正在连接飞书API...
2025-08-26 18:07:17,289 - feishu_client - INFO -            📋 获取工作表信息...
2025-08-26 18:07:17,517 - feishu_client - INFO - Token获取成功
2025-08-26 18:07:17,845 - feishu_client - INFO - 找到目标工作表: prd_model_sheet
2025-08-26 18:07:17,846 - feishu_client - INFO -            ✅ 工作表信息获取成功: prd_model_sheet
2025-08-26 18:07:17,846 - feishu_client - INFO -            🔗 构建数据请求...
2025-08-26 18:07:17,846 - feishu_client - INFO -            - 请求范围: A2:I1000
2025-08-26 18:07:17,846 - feishu_client - INFO -            🌐 发送API请求...
2025-08-26 18:07:18,189 - feishu_client - INFO -            ✅ API请求成功 (状态码: 0)
2025-08-26 18:07:18,189 - feishu_client - INFO -            📊 解析响应数据...
2025-08-26 18:07:18,189 - feishu_client - INFO -            - 原始数据行数: 999
2025-08-26 18:07:18,190 - feishu_client - INFO -            🔍 解析表格数据...
2025-08-26 18:07:18,190 - feishu_client - INFO - 使用默认列索引映射
2025-08-26 18:07:18,190 - feishu_client - INFO - 列映射: {'product_image': 0, 'model_image': 1, 'prompt': 2, 'status': 3, 'product_name': 5, 'model_name': 7, 'video_status': 8}
2025-08-26 18:07:18,190 - feishu_client - INFO - 解析行 1: 原始数据长度=9, product_name_idx=5
2025-08-26 18:07:18,190 - feishu_client - INFO - F列原始数据: '0826-Abvela'
2025-08-26 18:07:18,190 - feishu_client - INFO - 解析后的产品名: '0826-Abvela'
2025-08-26 18:07:18,190 - feishu_client - INFO - 解析行 2: 原始数据长度=9, product_name_idx=5
2025-08-26 18:07:18,191 - feishu_client - INFO - F列原始数据: '0826-freaks'
2025-08-26 18:07:18,191 - feishu_client - INFO - 解析后的产品名: '0826-freaks'
2025-08-26 18:07:18,191 - feishu_client - INFO - 解析行 3: 原始数据长度=9, product_name_idx=5
2025-08-26 18:07:18,191 - feishu_client - INFO - F列原始数据: '0826-beautifully broken'
2025-08-26 18:07:18,191 - feishu_client - INFO - 解析后的产品名: '0826-beautifully broken'
2025-08-26 18:07:18,191 - feishu_client - INFO - 解析行 4: 原始数据长度=9, product_name_idx=5
2025-08-26 18:07:18,191 - feishu_client - INFO - F列原始数据: '0826-HIPPIE SOUL'
2025-08-26 18:07:18,191 - feishu_client - INFO - 解析后的产品名: '0826-HIPPIE SOUL'
2025-08-26 18:07:18,192 - feishu_client - INFO - 解析行 5: 原始数据长度=9, product_name_idx=5
2025-08-26 18:07:18,192 - feishu_client - INFO - F列原始数据: '0826-life is better'
2025-08-26 18:07:18,192 - feishu_client - INFO - 解析后的产品名: '0826-life is better'
2025-08-26 18:07:18,192 - feishu_client - INFO - 解析行 6: 原始数据长度=9, product_name_idx=5
2025-08-26 18:07:18,192 - feishu_client - INFO - F列原始数据: '0826-Abvela'
2025-08-26 18:07:18,192 - feishu_client - INFO - 解析后的产品名: '0826-Abvela'
2025-08-26 18:07:18,192 - feishu_client - INFO - 解析行 7: 原始数据长度=9, product_name_idx=5
2025-08-26 18:07:18,192 - feishu_client - INFO - F列原始数据: '0826-freaks'
2025-08-26 18:07:18,192 - feishu_client - INFO - 解析后的产品名: '0826-freaks'
2025-08-26 18:07:18,193 - feishu_client - INFO - 解析行 8: 原始数据长度=9, product_name_idx=5
2025-08-26 18:07:18,193 - feishu_client - INFO - F列原始数据: '0826-beautifully broken'
2025-08-26 18:07:18,193 - feishu_client - INFO - 解析后的产品名: '0826-beautifully broken'
2025-08-26 18:07:18,193 - feishu_client - INFO - 解析行 9: 原始数据长度=9, product_name_idx=5
2025-08-26 18:07:18,193 - feishu_client - INFO - F列原始数据: '0826-HIPPIE SOUL'
2025-08-26 18:07:18,193 - feishu_client - INFO - 解析后的产品名: '0826-HIPPIE SOUL'
2025-08-26 18:07:18,193 - feishu_client - INFO - 解析行 10: 原始数据长度=9, product_name_idx=5
2025-08-26 18:07:18,193 - feishu_client - INFO - F列原始数据: '0826-life is better'
2025-08-26 18:07:18,193 - feishu_client - INFO - 解析后的产品名: '0826-life is better'
2025-08-26 18:07:18,195 - feishu_client - INFO - 处理了 10 行有效数据
2025-08-26 18:07:18,195 - feishu_client - INFO -            ✅ 数据解析完成
2025-08-26 18:07:18,195 - feishu_client - INFO -            - 有效数据行数: 10
2025-08-26 18:07:18,196 - __main__ - INFO -    ✅ 获取到 10 行数据
2025-08-26 18:07:18,196 - __main__ - INFO - 🚀 步骤3: 执行 图片合成工作流
2025-08-26 18:07:18,196 - WorkflowManager - INFO - 🚀 开始执行 图片合成工作流
2025-08-26 18:07:18,196 - WorkflowManager - INFO - 📊 总共需要处理 10 行数据
2025-08-26 18:07:18,196 - WorkflowManager - INFO - 📝 处理进度: 1/10 - 第 2 行
2025-08-26 18:07:18,196 - WorkflowManager - INFO -      ⏭️  跳过第 2 行（不需要处理）
2025-08-26 18:07:18,197 - WorkflowManager - INFO - 📝 处理进度: 2/10 - 第 3 行
2025-08-26 18:07:18,197 - WorkflowManager - INFO -      ⏭️  跳过第 3 行（不需要处理）
2025-08-26 18:07:18,197 - WorkflowManager - INFO - 📝 处理进度: 3/10 - 第 4 行
2025-08-26 18:07:18,197 - WorkflowManager - INFO -      ⏭️  跳过第 4 行（不需要处理）
2025-08-26 18:07:18,197 - WorkflowManager - INFO - 📝 处理进度: 4/10 - 第 5 行
2025-08-26 18:07:18,197 - WorkflowManager - INFO -      ⏭️  跳过第 5 行（不需要处理）
2025-08-26 18:07:18,207 - WorkflowManager - INFO - 📝 处理进度: 5/10 - 第 6 行
2025-08-26 18:07:18,207 - WorkflowManager - INFO -      ⏭️  跳过第 6 行（不需要处理）
2025-08-26 18:07:18,207 - WorkflowManager - INFO - 📝 处理进度: 6/10 - 第 7 行
2025-08-26 18:07:18,207 - ImageCompositionWorkflow - INFO -      🎨 开始处理图片合成 - 第 7 行
2025-08-26 18:07:18,208 - ImageCompositionWorkflow - INFO -         📥 下载产品图片和模特图片
2025-08-26 18:07:18,416 - feishu_client - INFO - Token获取成功
2025-08-26 18:07:19,646 - ImageCompositionWorkflow - INFO -         🔄 执行ComfyUI图片合成工作流
2025-08-26 18:07:19,646 - comfyui_client - INFO -         - 上传产品图片...
2025-08-26 18:07:20,026 - comfyui_client - INFO - 图片上传成功: api/6249d4cff2e335356b21910f866bfb580c0374763d16852128add124fbe95e03.png
2025-08-26 18:07:20,028 - comfyui_client - INFO -         ✅ 产品图片上传成功: api/6249d4cff2e335356b21910f866bfb580c0374763d16852128add124fbe95e03.png
2025-08-26 18:07:20,028 - comfyui_client - INFO -         - 上传模特图片...
2025-08-26 18:07:21,396 - comfyui_client - INFO - 图片上传成功: api/f221a5b2af83d2f4d6fda771bde0491cf8efbf2b72c87d88d9468f203117bfc4.png
2025-08-26 18:07:21,397 - comfyui_client - INFO -         ✅ 模特图片上传成功: api/f221a5b2af83d2f4d6fda771bde0491cf8efbf2b72c87d88d9468f203117bfc4.png
2025-08-26 18:07:21,397 - comfyui_client - INFO -         - 创建ComfyUI工作流...
2025-08-26 18:07:22,056 - comfyui_client - INFO - 工作流创建成功，任务ID: 1960282914925805570
2025-08-26 18:07:22,057 - comfyui_client - INFO -         ✅ 工作流创建成功，任务ID: 1960282914925805570
2025-08-26 18:07:22,058 - comfyui_client - INFO -         - 等待工作流执行完成...
2025-08-26 18:07:22,058 - comfyui_client - INFO -            - 开始等待任务完成，任务ID: 1960282914925805570
2025-08-26 18:07:22,058 - comfyui_client - INFO -            - 最大等待时间: 600秒，检查间隔: 120秒
2025-08-26 18:07:22,058 - comfyui_client - INFO -            - 检查任务状态... (已等待 0.0秒)
2025-08-26 18:07:22,351 - comfyui_client - ERROR - 检查任务状态失败: 未知错误
2025-08-26 18:07:22,352 - comfyui_client - WARNING -            ⚠️  状态检查失败 (1/3): 未知错误
2025-08-26 18:07:22,352 - comfyui_client - INFO -            - 等待 10 秒后重试状态检查...
2025-08-26 18:07:32,354 - comfyui_client - INFO -            - 检查任务状态... (已等待 10.3秒)
2025-08-26 18:07:32,620 - comfyui_client - ERROR - 检查任务状态失败: 未知错误
2025-08-26 18:07:32,621 - comfyui_client - WARNING -            ⚠️  状态检查失败 (2/3): 未知错误
2025-08-26 18:07:32,622 - comfyui_client - INFO -            - 等待 10 秒后重试状态检查...
2025-08-26 18:07:42,624 - comfyui_client - INFO -            - 检查任务状态... (已等待 20.6秒)
2025-08-26 18:07:42,851 - comfyui_client - ERROR - 检查任务状态失败: 未知错误
2025-08-26 18:07:42,852 - comfyui_client - WARNING -            ⚠️  状态检查失败 (3/3): 未知错误
2025-08-26 18:07:42,853 - comfyui_client - ERROR -            ❌ 状态检查连续失败 3 次: 未知错误
2025-08-26 18:07:42,853 - WorkflowManager - ERROR -      ❌ 第 7 行处理失败: 状态检查连续失败 3 次: 未知错误
2025-08-26 18:07:42,853 - WorkflowManager - INFO - 📝 处理进度: 7/10 - 第 8 行
2025-08-26 18:07:42,853 - ImageCompositionWorkflow - INFO -      🎨 开始处理图片合成 - 第 8 行
2025-08-26 18:07:42,853 - ImageCompositionWorkflow - INFO -         📥 下载产品图片和模特图片
2025-08-26 18:07:44,501 - ImageCompositionWorkflow - INFO -         🔄 执行ComfyUI图片合成工作流
2025-08-26 18:07:44,501 - comfyui_client - INFO -         - 上传产品图片...
2025-08-26 18:07:44,969 - comfyui_client - INFO - 图片上传成功: api/0ccfe6be91e2cc2413b363bc17e85e2d9ddeed3ebfa1ee1340e9b2276e87df07.png
2025-08-26 18:07:44,971 - comfyui_client - INFO -         ✅ 产品图片上传成功: api/0ccfe6be91e2cc2413b363bc17e85e2d9ddeed3ebfa1ee1340e9b2276e87df07.png
2025-08-26 18:07:44,972 - comfyui_client - INFO -         - 上传模特图片...
2025-08-26 18:07:45,792 - comfyui_client - INFO - 图片上传成功: api/f221a5b2af83d2f4d6fda771bde0491cf8efbf2b72c87d88d9468f203117bfc4.png
2025-08-26 18:07:45,793 - comfyui_client - INFO -         ✅ 模特图片上传成功: api/f221a5b2af83d2f4d6fda771bde0491cf8efbf2b72c87d88d9468f203117bfc4.png
2025-08-26 18:07:45,794 - comfyui_client - INFO -         - 创建ComfyUI工作流...
2025-08-26 18:07:46,015 - comfyui_client - WARNING - 创建工作流失败: ComfyUI任务队列已满，请稍后重试
2025-08-26 18:07:46,017 - WorkflowManager - ERROR -      ❌ 第 8 行处理失败: ComfyUI任务队列已满，请稍后重试
2025-08-26 18:07:46,017 - WorkflowManager - INFO - 📝 处理进度: 8/10 - 第 9 行
2025-08-26 18:07:46,017 - ImageCompositionWorkflow - INFO -      🎨 开始处理图片合成 - 第 9 行
2025-08-26 18:07:46,017 - ImageCompositionWorkflow - INFO -         📥 下载产品图片和模特图片
2025-08-26 18:07:47,208 - ImageCompositionWorkflow - INFO -         🔄 执行ComfyUI图片合成工作流
2025-08-26 18:07:47,208 - comfyui_client - INFO -         - 上传产品图片...
2025-08-26 18:07:47,656 - comfyui_client - INFO - 图片上传成功: api/88d2e00059f8d9b2321b5ea708cd5ea23b28216c0845789f2bc148ae41d8e5f1.png
2025-08-26 18:07:47,657 - comfyui_client - INFO -         ✅ 产品图片上传成功: api/88d2e00059f8d9b2321b5ea708cd5ea23b28216c0845789f2bc148ae41d8e5f1.png
2025-08-26 18:07:47,657 - comfyui_client - INFO -         - 上传模特图片...
2025-08-26 18:07:49,232 - comfyui_client - INFO - 图片上传成功: api/f221a5b2af83d2f4d6fda771bde0491cf8efbf2b72c87d88d9468f203117bfc4.png
2025-08-26 18:07:49,233 - comfyui_client - INFO -         ✅ 模特图片上传成功: api/f221a5b2af83d2f4d6fda771bde0491cf8efbf2b72c87d88d9468f203117bfc4.png
2025-08-26 18:07:49,234 - comfyui_client - INFO -         - 创建ComfyUI工作流...
2025-08-26 18:07:49,464 - comfyui_client - WARNING - 创建工作流失败: ComfyUI任务队列已满，请稍后重试
2025-08-26 18:07:49,466 - WorkflowManager - ERROR -      ❌ 第 9 行处理失败: ComfyUI任务队列已满，请稍后重试
2025-08-26 18:07:49,467 - WorkflowManager - INFO - 📝 处理进度: 9/10 - 第 10 行
2025-08-26 18:07:49,467 - ImageCompositionWorkflow - INFO -      🎨 开始处理图片合成 - 第 10 行
2025-08-26 18:07:49,467 - ImageCompositionWorkflow - INFO -         📥 下载产品图片和模特图片
2025-08-26 18:07:50,714 - ImageCompositionWorkflow - INFO -         🔄 执行ComfyUI图片合成工作流
2025-08-26 18:07:50,714 - comfyui_client - INFO -         - 上传产品图片...
2025-08-26 18:07:51,207 - comfyui_client - INFO - 图片上传成功: api/02586aa45ea970071eda97f61f374edc85a21aaa8636cf76ac09a7c4a0e0d7ed.png
2025-08-26 18:07:51,209 - comfyui_client - INFO -         ✅ 产品图片上传成功: api/02586aa45ea970071eda97f61f374edc85a21aaa8636cf76ac09a7c4a0e0d7ed.png
2025-08-26 18:07:51,209 - comfyui_client - INFO -         - 上传模特图片...
2025-08-26 18:07:52,044 - comfyui_client - INFO - 图片上传成功: api/f221a5b2af83d2f4d6fda771bde0491cf8efbf2b72c87d88d9468f203117bfc4.png
2025-08-26 18:07:52,046 - comfyui_client - INFO -         ✅ 模特图片上传成功: api/f221a5b2af83d2f4d6fda771bde0491cf8efbf2b72c87d88d9468f203117bfc4.png
2025-08-26 18:07:52,046 - comfyui_client - INFO -         - 创建ComfyUI工作流...
2025-08-26 18:07:52,255 - comfyui_client - WARNING - 创建工作流失败: ComfyUI任务队列已满，请稍后重试
2025-08-26 18:07:52,256 - WorkflowManager - ERROR -      ❌ 第 10 行处理失败: ComfyUI任务队列已满，请稍后重试
2025-08-26 18:07:52,256 - WorkflowManager - INFO - 📝 处理进度: 10/10 - 第 11 行
2025-08-26 18:07:52,256 - ImageCompositionWorkflow - INFO -      🎨 开始处理图片合成 - 第 11 行
2025-08-26 18:07:52,257 - ImageCompositionWorkflow - INFO -         📥 下载产品图片和模特图片
2025-08-26 18:07:53,651 - ImageCompositionWorkflow - INFO -         🔄 执行ComfyUI图片合成工作流
2025-08-26 18:07:53,651 - comfyui_client - INFO -         - 上传产品图片...
2025-08-26 18:07:54,118 - comfyui_client - INFO - 图片上传成功: api/84736c6dff387fd008826fc804d305faae280335416668792b8a03bea4fd4365.png
2025-08-26 18:07:54,119 - comfyui_client - INFO -         ✅ 产品图片上传成功: api/84736c6dff387fd008826fc804d305faae280335416668792b8a03bea4fd4365.png
2025-08-26 18:07:54,120 - comfyui_client - INFO -         - 上传模特图片...
2025-08-26 18:07:54,899 - comfyui_client - INFO - 图片上传成功: api/f221a5b2af83d2f4d6fda771bde0491cf8efbf2b72c87d88d9468f203117bfc4.png
2025-08-26 18:07:54,901 - comfyui_client - INFO -         ✅ 模特图片上传成功: api/f221a5b2af83d2f4d6fda771bde0491cf8efbf2b72c87d88d9468f203117bfc4.png
2025-08-26 18:07:54,901 - comfyui_client - INFO -         - 创建ComfyUI工作流...
2025-08-26 18:07:55,086 - comfyui_client - WARNING - 创建工作流失败: ComfyUI任务队列已满，请稍后重试
2025-08-26 18:07:55,088 - WorkflowManager - ERROR -      ❌ 第 11 行处理失败: ComfyUI任务队列已满，请稍后重试
2025-08-26 18:07:55,088 - __main__ - INFO - 📋 步骤4: 生成处理报告
2025-08-26 18:07:55,088 - __main__ - INFO - 
============================================================
📊 图片合成工作流 处理报告
============================================================
📈 处理统计:
   - 总行数: 10
   - 成功: 5
   - 失败: 5
   - 成功率: 50.0% (如果总行数 > 0)
   - 总耗时: 0.00 秒
   - 平均耗时: 0.00 秒/行

❌ 失败详情:
   - 第 7 行: 状态检查连续失败 3 次: 未知错误
   - 第 8 行: ComfyUI任务队列已满，请稍后重试
   - 第 9 行: ComfyUI任务队列已满，请稍后重试
   - 第 10 行: ComfyUI任务队列已满，请稍后重试
   - 第 11 行: ComfyUI任务队列已满，请稍后重试

✅ 成功处理的行:
   - 第 2 行
   - 第 3 行
   - 第 4 行
   - 第 5 行
   - 第 6 行

============================================================

2025-08-26 18:07:55,089 - __main__ - INFO - 处理报告已保存到: reports/report_20250826_180755.txt
2025-08-26 18:07:55,090 - __main__ - WARNING - 部分数据处理失败: 5/10
