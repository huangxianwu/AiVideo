# 飞书表格列顺序调整指南

## 概述

本系统已升级为基于表头名称的列识别机制，支持灵活调整飞书表格的列顺序，无需修改代码。

## 新特性

### 🎯 基于表头的列识别

系统现在通过表头名称（而非固定列位置）来识别列内容：

| 列功能 | 表头关键词 | 说明 |
|--------|------------|------|
| 产品图 | "产品图" | 包含此关键词的列将被识别为产品图列 |
| 模特图 | "模特图" | 包含此关键词的列将被识别为模特图列 |
| 提示词 | "提示词" | 包含此关键词的列将被识别为提示词列 |
| 图片处理状态 | "图片是否已处理" | 包含此关键词的列将被识别为状态列 |
| 合成图 | "产品模特合成图" | 包含此关键词的列将被识别为合成图列 |
| 产品名 | "产品名" | 包含此关键词的列将被识别为产品名列 |
| 模特名 | "模特名" | 包含此关键词的列将被识别为模特名列 |
| 视频状态 | "视频是否已实现" | 包含此关键词的列将被识别为视频状态列 |

### 🔄 列顺序调整支持

- ✅ **支持任意列顺序调整**：可以将任何列移动到任何位置
- ✅ **自动识别**：系统会自动根据表头名称识别列功能
- ✅ **向后兼容**：如果没有找到表头，会回退到默认的列位置
- ✅ **实时生效**：调整后立即生效，无需重启程序

## 使用方法

### 1. 调整列顺序

在飞书表格中，您可以：

1. **拖拽列**：直接拖拽列标题来调整顺序
2. **插入列**：在任意位置插入新列
3. **删除列**：删除不需要的列（注意保留必要的功能列）
4. **重命名列**：确保列名包含对应的关键词

### 2. 表头要求

确保表头名称包含相应的关键词：

```
✅ 正确示例：
- "产品图片" → 包含"产品图"，会被正确识别
- "模特照片" → 包含"模特图"，会被正确识别  
- "图片是否已处理完成" → 包含"图片是否已处理"，会被正确识别

❌ 错误示例：
- "图片A" → 不包含"产品图"，无法识别
- "处理状态" → 不包含"图片是否已处理"，无法识别
```

### 3. 验证调整结果

调整列顺序后，可以运行测试脚本验证：

```bash
# 验证列映射是否正确
python test_column_mapping.py

# 验证列顺序调整后的功能
python test_column_reorder.py
```

## 示例场景

### 场景1：将状态列移动到前面

**调整前：**
```
A(产品图) | B(模特图) | C(提示词) | D(图片是否已处理) | E(合成图) | ... | I(视频是否已实现)
```

**调整后：**
```
A(产品图) | B(模特图) | C(提示词) | D(视频是否已实现) | E(图片是否已处理) | F(合成图) | ...
```

**结果：** ✅ 系统会自动识别新的列位置，功能正常

### 场景2：插入新的辅助列

**调整前：**
```
A(产品图) | B(模特图) | C(提示词) | D(状态) | E(合成图)
```

**调整后：**
```
A(产品图) | B(模特图) | C(备注) | D(提示词) | E(状态) | F(合成图)
```

**结果：** ✅ 新插入的"备注"列不会影响系统功能

## 注意事项

### ⚠️ 重要提醒

1. **保持表头关键词**：调整列顺序时，确保表头名称仍包含必要的关键词
2. **避免重复关键词**：不要在多个列中使用相同的关键词
3. **测试验证**：调整后建议运行测试脚本验证功能
4. **备份数据**：重大调整前建议备份表格数据

### 🔧 故障排除

如果调整后出现问题：

1. **检查表头名称**：确认包含正确的关键词
2. **运行测试脚本**：使用测试脚本诊断问题
3. **查看日志**：检查程序运行日志中的错误信息
4. **回退更改**：如有问题可以回退到原来的列顺序

## 技术实现

### 配置文件更新

`config.py` 中的列映射配置已更新为基于关键词：

```python
# 旧版本（基于固定位置）
product_image_column: str = "A"
status_column: str = "D"

# 新版本（基于表头关键词）
product_image_column: str = "产品图"
status_column: str = "图片是否已处理"
```

### 自动映射逻辑

系统会在运行时：
1. 读取表格第一行作为表头
2. 搜索包含关键词的列
3. 建立列名到索引的映射
4. 如果找不到表头，回退到默认位置

## 总结

✅ **现在可以安全地调整飞书表格的列顺序**
✅ **系统会自动适应新的列布局**
✅ **无需修改代码或重启程序**
✅ **支持灵活的表格结构调整**

有任何问题，请参考测试脚本或查看程序运行日志。