# 表格列映射分析报告

## 问题概述

根据用户纠正和实际数据分析，发现当前代码中的列映射存在严重错误，导致工作流无法正确处理数据。

## 用户纠正的正确列映射

根据用户说明，正确的列映射应该是：

- **A列**: [需要确认具体内容]
- **B列**: 产品图 (用于图片合成输入)
- **C列**: 产品名 (用于视频文件名)
- **D列**: 模特图 (用于图片合成输入)
- **E列**: 模特名 (用于视频文件名)
- **F列**: 产品模特合成图 (图片合成输出)
- **G列**: 提示词 (用于图生视频输入)
- **H列**: 图片是否已处理 (图片合成状态判断)
- **I列**: 视频是否已实现 (视频生成状态判断)

## 当前代码中的错误映射

通过调试发现，当前代码中的映射是：

- **产品图** → A列 (应该是B列)
- **模特图** → B列 (应该是D列)
- **提示词** → C列 (应该是G列)
- **状态** → D列 (应该是H列)
- **合成图** → E列 (应该是F列)
- **产品名** → F列 (应该是C列)
- **模特名** → H列 (应该是E列)
- **视频状态** → I列 (正确)

## 实际数据分析

### 第2行数据示例：
- **A列**: "PA001" (产品编号)
- **B列**: 图片对象 `{'type': 'embed-image', 'fileToken': '...'}` (产品图)
- **C列**: "0826-Yes, I Can Drive a Stick" (产品名)
- **D列**: 图片对象 `{'fileToken': '...'}` (模特图)
- **E列**: "latin-女-18-马尾长发" (模特名)
- **F列**: 图片对象 `{'fileToken': '...'}` (合成图)
- **G列**: [需要确认] (提示词)
- **H列**: "已完成" (图片处理状态)
- **I列**: "已完成" (视频状态)

## 工作流逻辑分析

### 图片合成工作流
- **输入**: B列(产品图) + D列(模特图)
- **输出**: F列(合成图)
- **状态判断**: H列(图片是否已处理) == "否"

### 图生视频工作流
- **输入**: F列(合成图) + G列(提示词)
- **输出**: 视频文件
- **文件名**: C列(产品名) + E列(模特名)
- **状态判断**: I列(视频是否已实现) == "否"

## 需要修改的代码文件

### 1. config.py
更新列映射配置：
```python
# 列映射配置 - 基于表头名称识别
product_image_column: str = "产品图"  # B列
model_image_column: str = "模特图"    # D列
prompt_column: str = "提示词"         # G列
status_column: str = "图片是否已处理"  # H列
composite_image_column: str = "产品模特合成图"  # F列
product_name_column: str = "产品名"   # C列
model_name_column: str = "模特名"     # E列
video_status_column: str = "视频是否已实现"   # I列
```

### 2. feishu_client.py
更新 `_parse_sheet_data` 方法中的列索引映射逻辑。

### 3. workflow_manager.py
确保工作流判断逻辑使用正确的字段。

## 修复优先级

1. **高优先级**: 修复列映射配置
2. **高优先级**: 更新数据解析逻辑
3. **中优先级**: 验证工作流判断条件
4. **低优先级**: 添加数据验证和错误处理

## 验证计划

1. 修复列映射后重新运行调试脚本
2. 验证前3行数据的正确解析
3. 测试图片合成工作流的判断逻辑
4. 测试图生视频工作流的判断逻辑
5. 进行端到端工作流测试